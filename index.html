<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Advanced Calendar Generator</title>

<style>
:root {
  --bg: #121212;
  --card: #1e1e1e;
  --text: #eaeaea;
  --accent: #4da3ff;
  --border: #333;
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: system-ui, -apple-system, sans-serif;
  max-width: 650px;
  margin: auto;
  padding: 20px;
}

h2 {
  text-align: center;
  margin-bottom: 20px;
}

label {
  display: block;
  margin-top: 14px;
  font-weight: 600;
}

input, textarea, select, button {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  font-size: 16px;
  background: var(--card);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 6px;
  box-sizing: border-box;
}

textarea {
  resize: vertical;
}

button {
  cursor: pointer;
  background: var(--accent);
  border: none;
  font-weight: 600;
  transition: transform 0.05s ease, opacity 0.2s ease;
}

button:hover {
  opacity: 0.9;
}

button:active {
  transform: scale(0.98);
}

.buttons {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-top: 25px;
}

.full {
  grid-column: span 2;
}

#qrcode {
  margin-top: 30px;
  text-align: center;
}

canvas {
  background: white;
  padding: 10px;
  border-radius: 8px;
}

footer {
  margin-top: 40px;
  text-align: center;
  font-size: 13px;
  opacity: 0.5;
}
</style>
</head>

<body>

<h2>üìÖ Advanced Calendar Generator</h2>

<form id="eventForm">

<label>Event Title
<input id="title" required>
</label>

<label>Start
<input type="datetime-local" id="start" required>
</label>

<label>End
<input type="datetime-local" id="end" required>
</label>

<label>Time Zone
<select id="timezone">
<option value="UTC">UTC</option>
<option value="America/New_York">Eastern</option>
<option value="America/Chicago">Central</option>
<option value="America/Denver">Mountain</option>
<option value="America/Los_Angeles">Pacific</option>
</select>
</label>

<label>Recurring
<select id="recurring">
<option value="">None</option>
<option value="FREQ=DAILY">Daily</option>
<option value="FREQ=WEEKLY">Weekly</option>
<option value="FREQ=MONTHLY">Monthly</option>
</select>
</label>

<label>Location
<input id="location">
</label>

<label>Description
<textarea id="description"></textarea>
</label>

<label>Reminder (minutes before)
<input type="number" id="reminder" value="15" min="0">
</label>

<div class="buttons">

  <button class="full" type="submit">
    üì• Download (.ICS)
  </button>

  <button type="button" onclick="openGoogle()">
    üìÖ Google
  </button>

  <button type="button" onclick="generateQR()">
    üî≥ Generate QR
  </button>

  <button type="button" onclick="downloadQR()">
    ‚¨áÔ∏è Download QR
  </button>

  <button type="button" onclick="shareEvent()">
    üì§ Share
  </button>

</div>

</form>

<div id="qrcode"></div>

<footer>
  Free static calendar generator
</footer>

<!-- QR Library (offline capable after first load) -->
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<script>

function formatLocal(dateStr) {
  return dateStr.replace(/[-:]/g, "").replace(".000", "");
}

function getEventData() {
  return {
    title: title.value,
    start: formatLocal(start.value),
    end: formatLocal(end.value),
    location: location.value,
    description: description.value,
    reminder: reminder.value,
    recurring: recurring.value,
    timezone: timezone.value
  };
}

function buildICS(e) {
  return `BEGIN:VCALENDAR
VERSION:2.0
CALSCALE:GREGORIAN
BEGIN:VEVENT
UID:${Date.now()}@calendar
DTSTAMP:${formatLocal(new Date().toISOString())}
DTSTART;TZID=${e.timezone}:${e.start}
DTEND;TZID=${e.timezone}:${e.end}
SUMMARY:${e.title}
DESCRIPTION:${e.description}
LOCATION:${e.location}
${e.recurring ? "RRULE:" + e.recurring : ""}
BEGIN:VALARM
TRIGGER:-PT${e.reminder}M
ACTION:DISPLAY
DESCRIPTION:Reminder
END:VALARM
END:VEVENT
END:VCALENDAR`;
}

function downloadICS() {
  const e = getEventData();
  const blob = new Blob([buildICS(e)], { type: "text/calendar" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = `${e.title.replace(/\s+/g,"_")}.ics`;
  a.click();
}

function openGoogle() {
  const startUTC = new Date(start.value).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";
  const endUTC = new Date(end.value).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";

  const url = `https://calendar.google.com/calendar/render?action=TEMPLATE` +
  `&text=${encodeURIComponent(title.value)}` +
  `&dates=${startUTC}/${endUTC}` +
  `&details=${encodeURIComponent(description.value)}` +
  `&location=${encodeURIComponent(location.value)}`;

  window.open(url,"_blank");
}

function generateQR() {
  const startUTC = new Date(start.value).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";
  const endUTC = new Date(end.value).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";

  const googleURL = `https://calendar.google.com/calendar/render?action=TEMPLATE` +
  `&text=${encodeURIComponent(title.value)}` +
  `&dates=${startUTC}/${endUTC}`;

  document.getElementById("qrcode").innerHTML = "<canvas id='qr'></canvas>";
  QRCode.toCanvas(document.getElementById("qr"), googleURL, { width: 220 });
}

function downloadQR() {
  const canvas = document.getElementById("qr");
  if (!canvas) return alert("Generate QR first.");
  const link = document.createElement("a");
  link.download = "event-qr.png";
  link.href = canvas.toDataURL();
  link.click();
}

async function shareEvent() {
  const startUTC = new Date(start.value).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";
  const endUTC = new Date(end.value).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";

  const shareURL = `https://calendar.google.com/calendar/render?action=TEMPLATE` +
  `&text=${encodeURIComponent(title.value)}` +
  `&dates=${startUTC}/${endUTC}`;

  if (navigator.share) {
    await navigator.share({
      title: title.value,
      text: "Add this event:",
      url: shareURL
    });
  } else {
    alert("Sharing not supported on this device.");
  }
}

document.getElementById("eventForm").addEventListener("submit", function(e){
  e.preventDefault();
  downloadICS();
});

</script>

</body>
</html>
